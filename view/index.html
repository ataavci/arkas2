<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gemi Yakıt Verileri</title>
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="/static/css/style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body>
  <!-- =============== Navigation ================ -->
  <div class="container">
    <div class="navigation">
      <ul>
        <li><a href="#"><span class="title">arkas</span></a></li>
        <li><a href="#"><span class="icon"><ion-icon name="home-outline"></ion-icon></span><span class="title">Dashboard</span></a></li>
        <li><a href="./index.html"><span class="icon"><ion-icon name="people-outline"></ion-icon></span><span class="title">ETS</span></a></li>
        <li><a href="./kuralli_index.html"><span class="icon"><ion-icon name="chatbubble-outline"></ion-icon></span><span class="title">ets_tables</span></a></li>
        <li><a href="#"><span class="icon"><ion-icon name="help-outline"></ion-icon></span><span class="title">Help</span></a></li>
        <li><a href="#"><span class="icon"><ion-icon name="settings-outline"></ion-icon></span><span class="title">Settings</span></a></li>
        <li><a href="#"><span class="icon"><ion-icon name="lock-closed-outline"></ion-icon></span><span class="title">Password</span></a></li>
        <li><a href="#"><span class="icon"><ion-icon name="log-out-outline"></ion-icon></span><span class="title">Sign Out</span></a></li>
      </ul>
    </div>

    <!-- ========================= Main ==================== -->
    <div class="main">
      <div class="topbar">
        <div class="toggle"><ion-icon name="menu-outline"></ion-icon></div>
        <div class="search"><label><input type="text" placeholder="Search here"><ion-icon name="search-outline"></ion-icon></label></div>
        <div class="user"><img src="assets/imgs/customer01.jpg" alt=""></div>
      </div>

      <!-- ======================= Cards ================== -->
      <div class="cardBox">
        <div class="card"><div><div class="numbers">1,504</div><div class="cardName">Daily Views</div></div><div class="iconBx"><ion-icon name="eye-outline"></ion-icon></div></div>
        <div class="card"><div><div class="numbers">80</div><div class="cardName">Sales</div></div><div class="iconBx"><ion-icon name="cart-outline"></ion-icon></div></div>
        <div class="card"><div><div class="numbers">284</div><div class="cardName">Comments</div></div><div class="iconBx"><ion-icon name="chatbubbles-outline"></ion-icon></div></div>
        <div class="card"><div><div class="numbers">$7,842</div><div class="cardName">Earning</div></div><div class="iconBx"><ion-icon name="cash-outline"></ion-icon></div></div>
      </div>

      <h2>Sefer Bilgileri Girişi</h2>
      <form action="/sefer-kaydet" method="POST" id="seferForm">
        <label for="vessel_name">Vessel Name:</label>
        <input type="text" id="vessel_name" name="vessel_name" required><br><br>

        <!-- Seferin başlayacağı tarih alanı -->
        <label for="start_date">Start Date:</label>
        <input type="date" id="start_date" name="start_date" required><br><br>

        <div id="ayakInputs">
          <!-- İlk ayak için form inputları -->
          <div class="ayakInput" id="ayak_1">
            <label for="from_1">From Ayak 1:</label>
            <select id="from_1" name="from_1" required></select><br><br>
            <label for="to_1">To Ayak 1:</label>
            <select id="to_1" name="to_1" required></select><br><br>
            <label for="distance_1">Distance Ayak 1 (km):</label>
            <input type="number" id="distance_1" name="distance_1" step="any" required><br><br>
            <label for="distance_eca_1">Distance ECA Ayak 1 (km):</label>
            <input type="number" id="distance_eca_1" name="distance_eca_1" step="any" required><br><br>
            <label for="port_day_1">Port Day Ayak 1 (gün):</label>
            <input type="number" id="port_day_1" name="port_day_1" step="any" required><br><br>
            <label for="port_fuel_1">Port Yakıt Ayak 1:</label>
            <select id="port_fuel_1" name="port_fuel_1" required></select><br><br>
            <label for="sea_fuel_1">Sea Yakıt Ayak 1:</label>
            <select id="sea_fuel_1" name="sea_fuel_1" required></select><br><br>
            <label for="eca_fuel_1">ECA Sea Yakıt Ayak 1:</label>
            <select id="eca_fuel_1" name="eca_fuel_1" required></select><br><br>
          </div>
        </div>

        <button type="button" onclick="addAyak()">Add Ayak</button><br><br>

        <label for="speed">Hız (km/saat):</label>
        <input type="number" id="speed" name="speed" step="any" required><br><br>

        <label for="gunluk_tuketim_sea">Günlük Tüketim Sea (ton):</label>
        <input type="number" id="gunluk_tuketim_sea" name="gunluk_tuketim_sea" step="any" required><br><br>

        <label for="gunluk_tuketim_port">Günlük Tüketim Port (ton):</label>
        <input type="number" id="gunluk_tuketim_port" name="gunluk_tuketim_port" step="any" required><br><br>

        <button type="submit">Seferi Kaydet</button>
      </form>
    </div>
  </div>

  <script>
    let ayakCount = 1;
    let rotaData = [];
    let fuelData = [];

    function addAyak() {
      ayakCount++;
      const ayakInputs = document.getElementById("ayakInputs");

      // Bir önceki ayaktaki 'to' değerini alıyoruz
      const previousTo = document.getElementById(`to_${ayakCount - 1}`).value;

      // Yeni ayak inputlarını ekliyoruz
      const newAyak = document.createElement("div");
      newAyak.classList.add("ayakInput");
      newAyak.innerHTML = `
        <label for="from_${ayakCount}">From Ayak ${ayakCount}:</label>
        <select id="from_${ayakCount}" name="from_${ayakCount}" required>${generateOptions(rotaData)}</select><br><br>
        <label for="to_${ayakCount}">To Ayak ${ayakCount}:</label>
        <select id="to_${ayakCount}" name="to_${ayakCount}" required>${generateOptions(rotaData)}</select><br><br>
        <label for="distance_${ayakCount}">Distance Ayak ${ayakCount} (km):</label>
        <input type="number" id="distance_${ayakCount}" name="distance_${ayakCount}" step="any" required><br><br>
        <label for="distance_eca_${ayakCount}">Distance ECA Ayak ${ayakCount} (km):</label>
        <input type="number" id="distance_eca_${ayakCount}" name="distance_eca_${ayakCount}" step="any" required><br><br>
        <label for="port_day_${ayakCount}">Port Day Ayak ${ayakCount} (gün):</label>
        <input type="number" id="port_day_${ayakCount}" name="port_day_${ayakCount}" step="any" required><br><br>
        <label for="port_fuel_${ayakCount}">Port Yakıt Ayak ${ayakCount}:</label>
        <select id="port_fuel_${ayakCount}" name="port_fuel_${ayakCount}" required>${generateOptions(fuelData)}</select><br><br>
        <label for="sea_fuel_${ayakCount}">Sea Yakıt Ayak ${ayakCount}:</label>
        <select id="sea_fuel_${ayakCount}" name="sea_fuel_${ayakCount}" required>${generateOptions(fuelData)}</select><br><br>
        <label for="eca_fuel_${ayakCount}">ECA Sea Yakıt Ayak ${ayakCount}:</label>
        <select id="eca_fuel_${ayakCount}" name="eca_fuel_${ayakCount}" required>${generateOptions(fuelData)}</select><br><br>
      `;

      ayakInputs.appendChild(newAyak); // Yeni ayak inputlarını DOM'a ekliyoruz

      // Yeni ayak için from alanını bir önceki 'to' değeri ile otomatik dolduruyoruz
      document.getElementById(`from_${ayakCount}`).value = previousTo;
    }

    // Rota ve yakıt verilerini doldurmak için helper fonksiyon
    function generateOptions(data) {
      return data.map(item => `<option value="${item.port || item.Pathway_Name}">${item.port || item.Pathway_Name}</option>`).join("");
    }

    // Sayfa yüklendiğinde rota ve yakıt verilerini doldur
    document.addEventListener("DOMContentLoaded", () => {
      fetch("/rota_data")
        .then(response => response.json())
        .then(data => {
          rotaData = data;
          fillInitialAyak(); // İlk ayak verilerini doldur
        })
        .catch(err => console.error("Liman verileri alınırken hata oluştu:", err));

      fetch("/fuel_data")
        .then(response => response.json())
        .then(data => {
          fuelData = data;
          fillInitialAyak(); // İlk ayak verilerini doldur
        })
        .catch(err => console.error("Yakıt verileri alınırken hata oluştu:", err));
    });

    function fillInitialAyak() {
      if (rotaData.length > 0 && fuelData.length > 0) {
        document.getElementById("from_1").innerHTML = generateOptions(rotaData);
        document.getElementById("to_1").innerHTML = generateOptions(rotaData);
        document.getElementById("port_fuel_1").innerHTML = generateOptions(fuelData);
        document.getElementById("sea_fuel_1").innerHTML = generateOptions(fuelData);
        document.getElementById("eca_fuel_1").innerHTML = generateOptions(fuelData);
      }
    }
  </script>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
</body>
</html>
