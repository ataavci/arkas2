<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vessel Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style2.css">
    <style>
        /* CSS for hover effect on Vessel Name */
        #vesselTable tbody tr td.vessel-name:hover {
            background-color: green;
            color: white;
            cursor: pointer;
        }

        /* Modal styling */
        .modal-header, .modal-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-footer {
            justify-content: flex-end;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close:hover, .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        /* Responsive table with scroll */
        .table-responsive {
            max-width: 100%;
            overflow-x: auto;
        }

        table {
            min-width: 1200px;
        }

        th, td {
            padding: 8px;
            text-align: left;
        }
    </style>
</head>
<body>
    <!-- SIDEBAR -->
    <section id="sidebar">
        <a href="#" class="brand">
            <span class="text">Dashboard</span>
        </a>
        <ul class="side-menu top">
            <li class="active">
                <a href="./">
                    <span class="text">DASHBOARD</span>
                </a>
            </li>
            <li>
                <a href="./ets.html">
                    <span class="text">ETS</span>
                </a>
            </li>
            <li>
                <a href="./cii.html">
                    <span class="text">CII</span>
                </a>
            </li>
            <li>
                <a href="./fuel_eu.html">
                    <span class="text">FUEL EU</span>
                </a>
            </li>
            <li>
                <a href="./input.html">
                    <span class="text">INPUT</span>
                </a>
            </li>
            <li>
                <a href="./pool.html">
                    <span class="text">pool</span>
                </a>
            </li>
        </ul>
    </section>
    <!-- SIDEBAR -->

    <!-- CONTENT -->
    <section id="content-dashboard">
        <!-- NAVBAR -->
        <nav>
            <a href="#" class="nav-link">Search</a>
            <form action="#">
                <div class="form-input">
                    <input type="search" placeholder="Search...">
                    <button type="submit" class="search-btn">Search</button>
                </div>
            </form>
        </nav>
        <!-- NAVBAR -->

        <!-- MAIN -->
        <main>
            <div class="head-title">
                <div class="left">
                    <h1>Dashboard</h1>
                    <ul class="breadcrumb">
                        <li><a href="#">Dashboard</a></li>
                        <li>Vessel Consumption and ETS Report</li>
                    </ul>
                </div>
                <a href="#" id="btn-download-pdf" class="btn-download">
                    <span class="text">Download PDF</span>
                </a>
            </div>

            <!-- Modal to select vessels -->
            <div class="modal fade" id="vesselModal" tabindex="-1" aria-labelledby="vesselModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered"> <!-- modal-dialog-centered ile modal ekran覺n ortas覺nda olur -->
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="vesselModalLabel">Select Vessels</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div id="vessel-checkboxes">
                                <!-- Vessel checkbox content will be dynamically populated -->
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-primary" id="save-vessel-selection">Save Selection</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Form to select vessel and date range -->
            <div class="container mt-4">
                <form id="vessel-form">
                    <div class="form-input-inline">
                        <div class="mb-3">
                            <label for="vessel" class="form-label">Select Vessel(s)</label>
                            <input type="text" id="selected-vessels" class="form-control" readonly data-bs-toggle="modal" data-bs-target="#vesselModal" placeholder="Click to select vessels">
                        </div>

                        <div class="mb-3">
                            <label for="startDate" class="form-label">Start Date</label>
                            <input type="date" id="startDate" class="form-control" required>
                        </div>

                        <div class="mb-3">
                            <label for="endDate" class="form-label">End Date</label>
                            <input type="date" id="endDate" class="form-control" required>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary">Get Report</button>
                </form>
            </div>

            <!-- Table to display report data -->
            <div class="table-responsive mt-4">
                <table id="vesselTable" class="table table-striped">
                    <thead>
                        <tr>
                            <th>Vessel Name</th>
                            <th>Sefer Tekrar Say覺s覺</th>
                           
                            <th>Leg Durumu</th>
                            <th>Current Leg</th>
                            <th>Total Distance</th>
                            <th>ECA Distance</th>
                            <th>Sea Fuel Consumption</th>
                            <th>ECA Fuel Consumption</th>
                            <th>Port Fuel Consumption</th>
                            <th>ETS</th>
                            <th>Compliance Balance</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Dynamic content will be inserted here -->
                    </tbody>
                </table>
            </div>
        </main>
    </section>

    <!-- Script -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Load vessel names into the modal
        async function loadVesselNames() {
            try {
                const response = await fetch('/api/vessels');
                const vesselNames = await response.json();

                const vesselCheckboxes = document.getElementById('vessel-checkboxes');
                vesselCheckboxes.innerHTML = '';  // Clear previous content

                vesselNames.forEach(vessel => {
                    const checkboxDiv = document.createElement('div');
                    checkboxDiv.classList.add('checkbox-inline');
                    checkboxDiv.innerHTML = `
                        <input type="checkbox" id="vessel-${vessel.vessel_name}" value="${vessel.vessel_name}">
                        <label for="vessel-${vessel.vessel_name}">${vessel.vessel_name}</label>
                    `;
                    vesselCheckboxes.appendChild(checkboxDiv);
                });
            } catch (error) {
                console.error('Error loading vessels:', error);
            }
        }

        // Save vessel selection from modal
        document.getElementById('save-vessel-selection').addEventListener('click', function() {
            const selectedVessels = Array.from(document.querySelectorAll('#vessel-checkboxes input[type="checkbox"]:checked'))
                .map(cb => cb.value)
                .join(', ');

            document.getElementById('selected-vessels').value = selectedVessels || 'No vessel selected';
        });

        // Form submission to get report
        document.getElementById('vessel-form').addEventListener('submit', async function(event) {
            event.preventDefault();

            const vessels = document.getElementById('selected-vessels').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;

            if (!vessels || vessels === 'No vessel selected') {
                alert('Please select at least one vessel.');
                return;
            }

            try {
                const response = await fetch(`/api/vessel-report?startDate=${startDate}&endDate=${endDate}&vessels=${vessels}`);
                const results = await response.json();

                const tableBody = document.querySelector('#vesselTable tbody');
                tableBody.innerHTML = '';  // Clear previous table data

                results.forEach(row => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${row.vessel_name}</td>
                        <td>${row.sefer_tekrar_sayisi}</td>
                        
                        <td>${row.leg_durumu}</td>
                        <td>${row.current_leg}</td>
                        <td>${row.distance_sum}</td>
                        <td>${row.distance_eca_sum}</td>
                        <td>${row.sea_fuel_sum}</td>
                        <td>${row.eca_fuel_sum}</td>
                        <td>${row.port_fuel_sum}</td>
                        <td>${row.ets_sum}</td>
                        <td>${row.complian_balance}</td>
                    `;
                    tableBody.appendChild(tr);
                });
            } catch (error) {
                console.error('Error fetching report:', error);
            }
        });

        // Load vessel names when modal is opened
        document.getElementById('vesselModal').addEventListener('show.bs.modal', loadVesselNames);
    </script>

</body>
</html>
