<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sefer Bilgileri Dashboard</title>
    <link rel="stylesheet" href="/static/css/deneme.css">
</head>
<body>
    <div class="container">
        <h1>Sefer Bilgileri</h1>

        <!-- Tarih seçim alanları -->
        <form id="seferForm">
            <label for="start_date">Başlangıç Tarihi:</label>
            <input type="date" id="start_date" name="start_date" required>

            <label for="end_date">Bitiş Tarihi:</label>
            <input type="date" id="end_date" name="end_date" required>

            <button type="submit">Sonuçları Göster</button>
        </form>

        <!-- Sefer tabloları listesi -->
        <div id="sefer-tablolari">
            <h2>Sefer Tabloları Listesi</h2>
            <ul id="seferList">
                <!-- Dinamik olarak buraya tablolar yüklenecek -->
            </ul>
        </div>

        <!-- Sonuçlar tablosu -->
        <div id="results">
            <h2>Sefer Sonuçları</h2>
            <table id="resultsTable">
                <thead>
                    <tr>
                        <th>Ayak Numarası</th>
                        <th>Başlangıç Limanı</th>
                        <th>Bitiş Limanı</th>
                        <th>Başlangıç Tarihi</th>
                        <th>Bitiş Tarihi</th>
                        <th>Hangi Ayakta Bitti</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Sonuçlar burada görüntülenecek -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Sefer tablolarını listelemek için istek atıyoruz
        fetch("/sefer-tablolari")
            .then((response) => response.json())
            .then((tables) => {
                const seferList = document.getElementById("seferList");

                // Her tabloyu liste olarak ekleyelim
                tables.forEach((table) => {
                    const li = document.createElement("li");
                    li.textContent = table;
                    seferList.appendChild(li);
                });
            })
            .catch((error) => {
                console.error("Sefer tabloları alınırken bir hata oluştu:", error);
            });

        document.getElementById("seferForm").addEventListener("submit", function (event) {
            event.preventDefault();

            const startDate = document.getElementById("start_date").value;
            const endDate = document.getElementById("end_date").value;

            fetch("/seferler", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ start_date: startDate, end_date: endDate }),
            })
            .then((response) => response.json())
            .then((data) => {
                const resultsTableBody = document.querySelector("#resultsTable tbody");
                resultsTableBody.innerHTML = ""; // Önceki sonuçları temizle

                data.forEach((row, index) => {
                    const tr = document.createElement("tr");
                    tr.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${row.from_liman}</td>
                        <td>${row.to_liman}</td>
                        <td>${row.start_date}</td>
                        <td>${row.end_date}</td>
                        <td>${row.sefer_status}</td>
                    `;
                    resultsTableBody.appendChild(tr);
                });
            })
            .catch((error) => {
                console.error("Sonuçlar alınırken bir hata oluştu:", error);
            });
        });
    </script>
</body>
</html>
