<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="/static/css/dashboard.css">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <title>Erkport</title>
</head>

<body>

    <div class="container-fluid py-2">
        <div class="row d-flex">

            <div class="container col-sm-12 col-md-3 col-xl-2 mb-sm-5 nav-div">

                <nav>
                    <div class="container-fluid">
                        <div class="navbar-brand col-12">
                            <img src="/static/image/erk.png" class="w-100" alt="arkas logo">
                        </div>

                        <hr>

                        <div class="container-fluid">
                            <ul class="menu-links my-2 p-2 col-12">
                                <li class="nav-item">
                                    <a class="nav-link" href="./dashboard.html">DASHBOARD</a>
                                </li>

                                <li class="nav-item">
                                    <a class="nav-link" href="./ets.html">ETS</a>
                                </li>

                                <li class="nav-item">
                                    <a class="nav-link" href="./cii.html">CII</a>
                                </li>

                                <li class="nav-item">
                                    <a class="nav-link" href="./fuel_eu.html">FUEL EU</a>
                                </li>

                                <li class="nav-item">
                                    <a class="nav-link" href="./input.html">INPUT</a>
                                </li>

                                <li class="nav-item">
                                    <a class="nav-link" href="./pool.html">POOL</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="./pooldetails.html">POOL DETAILS</a>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <div class="logout-button-div">
                        <button class="btn btn-danger logout-button fw-bold col-12">Logout</button>
                    </div>

                </nav>
            </div>

            <div class="container-fluid col-sm-12 col-md-9 col-xl-10 mt-sm-2 mt-md-2 pt-3 px-4">

                <div class="container header-and-button">
                    <div class="header">
                        <h2 class="h2 fw-bold mx-sm-3 mx-xl-4 my-3">Dashboard</h2>
                    </div>
                    <div class="downland-pdf-button-div">
                        <button class="btn btn-outline-primary">Downland PDF</button>
                    </div>
                </div>


                <div class="container cards p-2">

                    <div class="row">

                        <div class="card p-2 col-sm-6 col-md-4 col-xl-2">
                            <div class="card-header fw-bold">
                                Total Consumption
                            </div>
                            <div class="card-body">
                                <div class="card-title">
                                    <p id="total-consumption-value">Yükleniyor..</p>
                                </div>
                            </div>
                            
                        </div>

                        <div class="card p-2 col-sm-6 col-md-4 col-xl-2">
                            <div class="card-header fw-bold">
                                Complian Balance
                            </div>
                            <div class="card-body">
                                <div class="card-title">
                                    <p id="complian-balance-value">Yükleniyor..</p>
                                </div>
                            </div>
                        </div>
<!--
                        <div class="card p-2 col-sm-6 col-md-4 col-xl-2">
                            <div class="card-header fw-bold">
                                GHG Intensity
                            </div>
                            <div class="card-body">
                                <div class="card-title">
                                    <p id="ghg_intensity-value">Yükleniyor...</p>
                                </div>
                            </div>
                        </div>
-->

                        <div class="card p-2 col-sm-6 col-md-4 col-xl-2">
                            <div class="card-header fw-bold">
                                FuelEU Cost
                            </div>
                            <div class="card-body">
                                <div class="card-title">
                                    12,152
                                </div>
                            </div>
                        </div>

                        <div class="card p-2 col-sm-6 col-md-4 col-xl-2">
                            <div class="card-header fw-bold">
                                ETS Cost
                            </div>
                            <div class="card-body">
                                <div class="card-title">
                                    94,127
                                </div>
                            </div>
                        </div>

                        <div class="card p-2 col-sm-6 col-md-4 col-xl-2">
                            <div class="card-header fw-bold">
                                Total Cost
                            </div>
                            <div class="card-body">
                                <div class="card-title">
                                    168,540
                                </div>
                            </div>
                        </div>


                    </div>

                    <div class="table-responsive container mt-5" style="max-height: 440px; overflow-y: auto;">
                        <table class="table vessel-table">
                            <thead>
                                <tr class="table-warning">
                                    <th scope="col">Vessel Name</th>
                                    <th scope="col">Sea Fuel</th>
                                    <th scope="col">Sea Consumption</th>
                                    <th scope="col">ECA Fuel</th>
                                    <th scope="col">ECA Consumption</th>
                                    <th scope="col">Port Fuel</th>
                                    <th scope="col">Port Consumption</th>
                                    <th scope="col">CII Rating</th>
                                </tr>
                            </thead>
                            <tbody id="vessel-table-body" class="vessel-table-body">
                                <!-- Rows will be dynamically inserted here -->
                            </tbody>
                        </table>
                    </div>
                    <br>
                    <hr>

                    <h2 class="h2 mx-sm-3 mx-xl-4 mt-5 mb-4">ETS Dashboard</h2>
                    <div class="container">
                        <div class="row g-4">

                            <div class="col-sm-12 col-xl-6">

                                <div class="card">
                                    <div class="card-header text-center fw-bold bg-primary">
                                        
                                    </div>

                                    <div class="card-body" id="barChart1">
                                        <!--Bar Chart1-->
                                    </div>
                                </div>

                            </div>


                            <div class="col-sm-12 col-xl-6">
                                <div class="card">
                                    <div class="card-header text-center fw-bold bg-success">
                                       
                                    </div>

                                    <div class="card-body" id="lineChart1">
                                        <!--Line Chart1-->
                                    </div>
                                </div>

                            </div>


                        </div>
                    </div>


                    <br>
                    <hr>


                    <h2 class="h2 mx-sm-3 mx-xl-4 mt-5 mb-4">Emission Dashboard</h2>
                    <div class="container">
                        <div class="row g-4">

                            <div class="col-sm-12 col-xl-6">

                                <div class="card">
                                    <div class="card-header text-center fw-bold bg-primary">
                                        
                                    </div>

                                    <div class="card-body" id="barChart2">
                                        <!--Bar Chart2-->
                                    </div>
                                </div>

                            </div>


                            <div class="col-sm-12 col-xl-6">
                                <div class="card">
                                    <div class="card-header text-center fw-bold bg-success">
                                      
                                    </div>

                                    <div class="card-body" id="lineChart2">
                                        <!--Line Chart2-->
                                    </div>
                                </div>

                            </div>


                        </div>
                    </div>



                </div>

            </div>

        </div>

    </div>





<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
        <script src="/static/js/charts.js"></script>

            <script>
                
                window.onload = async function() {
                    
                        
                        // Fetch data to update content
                        await fetchTotalConsumption();
                        await fetchComplianBalance();
                        await fetchghgintensity();
                        await fetchVesselData();};
                        
                   
              

                // Fetch and update Total Consumption
                // Fetch and update Total Consumption
async function fetchTotalConsumption() {
    try {
        console.log('Fetching total consumption...');
        
        const response = await fetch('/api/total-consumption');  // Fetch data from API
        console.log('Response status:', response.status);  // Log response status
        
        if (!response.ok) {
            throw new Error(`Network response was not ok, status: ${response.status}`);
        }
        
        const data = await response.json();  // Parse JSON response
        console.log("Total Consumption Data: ", data);  // Log data for debugging

        // Set the total consumption value to the p element, or 'No data' if not available
        document.getElementById('total-consumption-value').textContent = data.totalConsumption || 'No data';
    } catch (error) {
        console.error('Error fetching total consumption data:', error);
        // Display error message in case of failure
        document.getElementById('total-consumption-value').textContent = 'Error fetching data';
    }
}

                // Fetch and update Complian Balance
                async function fetchComplianBalance() {
                    try {
                        const response = await fetch('/api/complian-balance');
                        const data = await response.json();
                        console.log("Complian Balance Data: ", data);  // Log the data for debugging
                        document.getElementById('complian-balance-value').textContent = data.complianBalance || 'No data';
                    } catch (error) {
                        console.error('Error fetching complian balance data:', error);
                    }
                }

                
                

                // Fetch and update Vessel Data
                async function fetchVesselData() {
                    try {
                        const response = await fetch('/api/vessels');  // Fetch data from API
                        const vessels = await response.json();  // Parse JSON data
                        console.log("Vessel Data: ", vessels);  // Log the data for debugging

                        const tableBody = document.getElementById('vessel-table-body');
                        tableBody.innerHTML = '';  // Clear existing rows

                        vessels.forEach(vessel => {
                            const row = document.createElement('tr');
                            const ciiRating = vessel.CII ? vessel.CII.toLowerCase() : 'n/a';
                            row.innerHTML = `
                                <td>${vessel.vessel_name}</td>
                                <td>${vessel.sea_fuel}</td>
                                <td>${vessel.sea_consumption}</td>
                                <td>${vessel.eca_fuel}</td>
                                <td>${vessel.eca_consumption}</td>
                                <td>${vessel.port_fuel}</td>
                                <td>${vessel.port_consumption}</td>
                                <td><span class="cii-rating ${ciiRating}">${vessel.CII || 'N/A'}</span></td>
                            `;
                            tableBody.appendChild(row);
                        });
                    } catch (error) {
                        console.error('Error fetching vessel data:', error);
                    }
                }

                // Fetch and update Chart 1 data
                async function fetchVesselData() {
        try {
            const response = await fetch('/api/vessels');  // Fetch data from API
            const vessels = await response.json();  // Parse JSON data
            console.log("Vessel Data: ", vessels);  // Log the data for debugging

            const tableBody = document.getElementById('vessel-table-body');
            tableBody.innerHTML = '';  // Clear existing rows

            vessels.forEach(vessel => {
                const row = document.createElement('tr');
                const ciiRating = vessel.CII ? vessel.CII.toUpperCase() : 'N/A';
                
                // Define the badge color based on CII rating
                let badgeClass = '';
                if (ciiRating === 'A') {
                    badgeClass = 'bg-success';
                } else if (ciiRating === 'B' || ciiRating === 'C') {
                    badgeClass = 'bg-warning';
                } else if (ciiRating === 'D' || ciiRating === 'E') {
                    badgeClass = 'bg-danger';
                } else {
                    badgeClass = 'bg-secondary';
                }

                // Insert the row with fetched data
                row.innerHTML = `
                    <td>${vessel.vessel_name}</td>
                    <td>${vessel.sea_fuel}</td>
                    <td>${vessel.sea_consumption}</td>
                    <td>${vessel.eca_fuel}</td>
                    <td>${vessel.eca_consumption}</td>
                    <td>${vessel.port_fuel}</td>
                    <td>${vessel.port_consumption}</td>
                    <td><span class="badge ${badgeClass}">${ciiRating}</span></td>
                `;
                tableBody.appendChild(row);  // Append row to the table body
            });
        } catch (error) {
            console.error('Error fetching vessel data:', error);
        }
    }

    // Call the function to fetch vessel data when the page loads
    document.addEventListener('DOMContentLoaded', () => {
        fetchVesselData();
    });
                

</script>
</body>
</html>
