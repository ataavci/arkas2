<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="icon" href="/static/image/favicon-16x16.png" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style2.css">
</head>
<body>
    <!-- SIDEBAR -->
    <section id="sidebar" class="sidebar bg-light">
        <a href="#" class="brand">
            <i class='bx bxs-smile'></i>
            <span class="text"></span>
        </a>
        <ul class="side-menu top">
            <li class="active">
                <a class="nav-link dropdown-toggle" style="border: 5px;" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    Optimizasyon
                  </a>
                  <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="./dashboard.html">DASHBOARD</a></li>
                    <li><a class="dropdown-item" href="./ets.html">ETS</a></li>
                    <li><a class="dropdown-item" href="./cii.html">CII</a></li>
                    <li><a class="dropdown-item" href="./fuel_eu.html">FUEL EU</a></li>
                    <li><a class="dropdown-item" href="./input.html">ADD VESSEL</a></li>
                  </ul>
            </li>
        </ul>
    </section>
    <!-- SIDEBAR -->

    <!-- CONTENT -->
    <section id="content-dashboard" class="content">
        <!-- MAIN -->
        <main>
            <div class="head-title">
                <h1>Dashboard</h1>
                <ul class="breadcrumb">
                    <li><a href="#">Dashboard</a></li>
                    <li><i class='bx bx-chevron-right'></i></li>
                </ul>
                <a href="#" class="btn btn-primary btn-download">
                    <i class='bx bxs-cloud-download'></i>
                    Download PDF
                </a>
            </div>

            <!-- Stats Section -->
            <div class="stats-container row">
                <div class="col-md-2 stat-card text-center">
                    <h3>Toplam Tüketim</h3>
                    <p id="total-consumption-value">Yükleniyor...</p>
                </div>
                <div class="col-md-2 stat-card text-center">
                    <h3>Complian Balance</h3>
                    <p id="complian-balance-value">Yükleniyor...</p>
                </div>
                <div class="col-md-2 stat-card text-center">
                    <h3>GHG Intensity</h3>
                    <p id="ghg_intensity-value">Yükleniyor...</p>
                </div>
                <div class="col-md-2 stat-card text-center">
                    <h3>FuelEU Cost</h3>
                    <p>12,152</p>
                </div>
                <div class="col-md-2 stat-card text-center">
                    <h3>ETS Cost</h3>
                    <p>94,127</p>
                </div>
                <div class="col-md-2 stat-card text-center">
                    <h3>Total Cost</h3>
                    <p>168,540</p>
                </div>
            </div>

            <!-- Vessel Data Table -->
            <div class="vessel-table-container mt-4">
                <h2>All Vessels</h2>
                <table class="table table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th>Vessel Name</th>
                            <th>Sea Fuel</th>
                            <th>Sea Consumption</th>
                            <th>ECA Fuel</th>
                            <th>ECA Consumption</th>
                            <th>Port Fuel</th>
                            <th>Port Consumption</th>
                            <th>CII Rating</th>
                        </tr>
                    </thead>
                    <tbody id="vessel-table-body">
                        <!-- Dinamik veri buraya yüklenecek -->
                    </tbody>
                </table>
            </div>

            <!-- Charts Section -->
            <div class="charts-container mt-4">
                <div class="row">
                    <div class="col-md-6">
                        <h3>ETS</h3>
                        <div class="chart" id="chart-ets"></div>
                    </div>
                    <div class="col-md-6">
                        <h3>CO2 Emissions</h3>
                        <div class="chart" id="chart-co2"></div>
                    </div>
                    <div class="col-md-6 mt-4">
                        <h3>Fuel Consumption</h3>
                        <div class="chart" id="chart-fuel"></div>
                    </div>
                    <div class="col-md-6 mt-4">
                        <h3>CII Rating Distribution</h3>
                        <div class="chart" id="chart-cii"></div>
                    </div>
                </div>
            </div>
        </main>
    </section>

    <script>
        // API'den verileri çek ve tabloyu güncelle

        async function fetchTotalConsumption() {
            try {
                const response = await fetch('/api/total-consumption');
                const data = await response.json();
                document.getElementById('total-consumption-value').textContent = data.totalConsumption;
            } catch (error) {
                console.error('Toplam tüketim verisi çekilirken bir hata oluştu:', error);
            }
        }

        async function fetchComplianBalance() {
            try {
                const response = await fetch('/api/complian-balance');
                const data = await response.json();
                document.getElementById('complian-balance-value').textContent = data.complianBalance;
            } catch (error) {
                console.error('Complian balance verisi çekilirken bir hata oluştu:', error);
            }
        }

        async function fetchghgintensity() {
            try {
                const response = await fetch('/api/ghg_intensity');
                const data = await response.json();
                document.getElementById('ghg_intensity-value').textContent = data.GHG_intensity;
            } catch (error) {
                console.error('GHG intensity verisi çekilirken bir hata oluştu:', error);
            }
        }

        async function fetchVesselData() {
    try {
        const response = await fetch('/api/vessels');  // API'ye istek gönder
        const vessels = await response.json();  // Gelen JSON verisini al
        
        console.log('Vessels Data:', vessels);  // Gelen veriyi konsola yazdır

        const tableBody = document.getElementById('vessel-table-body');
        console.log('Table Body:', tableBody);  // Tablo gövdesini kontrol et

        // Tüm verileri tabloya ekle
        vessels.forEach(vessel => {
            console.log('Vessel CII:', vessel.CII);  // Her bir geminin CII değerini kontrol et
            const row = document.createElement('tr');
            
            // CII undefined ise bir default değer verelim
            const ciiRating = vessel.CII ? vessel.CII.toLowerCase() : 'n/a';
            row.innerHTML = `
                <td>${vessel.vessel_name}</td>
                <td>${vessel.sea_fuel}</td>
                <td>${vessel.sea_consumption}</td>
                <td>${vessel.eca_fuel}</td>
                <td>${vessel.eca_consumption}</td>
                <td>${vessel.port_fuel}</td>
                <td>${vessel.port_consumption}</td>
                <td><span class="cii-rating ${ciiRating}">${vessel.CII || 'N/A'}</span></td>
            `;
            tableBody.appendChild(row);
        });
    } catch (error) {
        console.error('Veriler çekilirken bir hata oluştu:', error);
    }
}


        // Sayfa yüklendiğinde tüm API'leri çağır
        window.onload = function() {
            fetchTotalConsumption();
            fetchComplianBalance();
            fetchghgintensity();
            fetchVesselData();
        };
        
    </script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.canvasjs.com/ga/canvasjs.min.js"></script>
    <script src="./static/js/script.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
